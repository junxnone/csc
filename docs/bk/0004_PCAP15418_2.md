-----

| Title     | PCAP15418 2                                      |
| --------- | ------------------------------------------------ |
| Created @ | `2021-09-26T03:27:07Z`                           |
| Updated @ | `2023-07-16T08:46:46Z`                           |
| Labels    | \`\`                                             |
| Edit @    | [here](https://github.com/junxnone/csc/issues/4) |

-----

## Brief

  - å¤šæ ·çš„å¤„ç†å™¨ CPU/GPU/FPGA/VPU/...
  - ä¸åŒå¤„ç†å™¨çš„å¹¶è¡Œæ–¹æ³•
  - ILP
      - Pipelining & Superscalar - åŒæ—¶æ‰§è¡Œå¤šæ¡æŒ‡ä»¤
      - Out of order execution - åŠ¨æ€è°ƒåº¦æ‰§è¡ŒæŒ‡ä»¤
      - Speculation - é¢„æµ‹ä¸‹æ¡æŒ‡ä»¤
  - in-order/out-of-order

## å„ç§å¤„ç†å™¨

| Processors | ç”¨é€”            | å¹¶è¡Œæ–¹æ³•    | è°ƒåº¦   | Cores   | Hardware | ç¼–ç¨‹å›°éš¾åº¦ |
| ---------- | ------------- | ------- | ---- | ------- | -------- | ----- |
| CPU        | åºåˆ—åŒ–çš„ code     | ILP     | ç¡¬ä»¶è°ƒåº¦ | \<100   | æ˜‚è´µå¤æ‚     | å®¹æ˜“    |
| GPU        | å¾ˆå¤šç‹¬ç«‹çš„ task    | çº¿ç¨‹åŠæ•°æ®å¹¶è¡Œ | è½¯ä»¶è°ƒåº¦ | \> 1000 | ç®€å•ä¾¿å®œ     | å›°éš¾    |
| FPGA       | ä¿¡å·å¤„ç†/ç¥ç»ç½‘ç»œ/... |         |      |         |          |       |
| VPU        | ç¥ç»ç½‘ç»œ          |         |      |         |          |       |

## CPU ILP - `instruction-level parallelism`

### Simple CPU Model

  - **Fetch** â€“ get the next instruction from memory
  - **Decode** â€“ figure out what to do & read inputs
  - **Execute** â€“ perform the necessary operations
  - **Commit** â€“ write the results back to registers / memory

| ![image](media/0bf2d9393c02b09eecd71b432cb730fee695150d.png) | ![InkedFoxitReader\_BXqXJmKJV8\_LI](media/62a404ea11165ab8df2a1d9057909dab537e99f3.jpg) |
| ------------------------------------------------------------ | --------------------------------------------------------------------------------------- |

### **Pipelining**

  - ğ‘-stage pipeline gives up to ğ‘ Ã— speedup(N = 15 æ˜¯ä¸ªä¸´ç•Œç‚¹)
  - `Fetch/Decode/Execute/Commit` - 4X Speedup
  - ä¸€äº›é™åˆ¶ Pipeling å¹¶è¡Œçš„å› ç´ 
      - **Data Hazards**
      - **Control Hazards**

| ![image](media/6bda88a84661008f1d720263187a19ee1cf6958b.png) | ![Inkedchrome\_k49UtilsYB\_LI](media/d26926079343353a090178e44faecb0ad092345e.jpg) |
| ------------------------------------------------------------ | ---------------------------------------------------------------------------------- |

#### Data Hazards & Forwarding data

  - **Data hazards:**
      - å¹¶è¡Œéœ€è¦æ˜¯ç‹¬ç«‹çš„ä»»åŠ¡, è€Œè®¸å¤šæŒ‡ä»¤ä¹‹é—´å¹¶ä¸ç‹¬ç«‹(å¯„å­˜å™¨è¯»å†™ä¾èµ–)
      - å½“åä¸€æ¡æŒ‡ä»¤éœ€è¦ç”¨åˆ°å‰ä¸€æ¡æŒ‡ä»¤çš„å¯„å­˜å™¨æ—¶ä¼šå¡«å…… `NOP` æŒ‡ä»¤, ä»¥ç­‰åˆ°å‰ä¸€æ¡æŒ‡ä»¤ `commit`
      - **example:** å‰ä¸€æ¡æŒ‡ä»¤è¦å†™ `R3`, åä¸€æ¡æŒ‡ä»¤æ‰§è¡Œæ—¶è¦è¯» `R3`, åä¸€æ¡æŒ‡ä»¤æ‰§è¡Œæ—¶,å‰ä¸€æ¡æŒ‡ä»¤è¿˜æ²¡æœ‰
        `commit`

| ![image](media/5adeae18374c1cef3c7a2a91d7baeb542b7fc798.png) | ![Inkedchrome\_lKvXLJsrqG\_LI](media/bf9e891da16feb13447aa3fa8d7de821a0ea7891.jpg) |
| ------------------------------------------------------------ | ---------------------------------------------------------------------------------- |

  - è§£å†³æ–¹æ¡ˆ: **Forwarding data** - CPUåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼ŒæŠŠä¸€ä¸ªå•å…ƒçš„è¾“å‡ºå€¼å†…å®¹æ‹·è´åˆ°å¦ä¸€ä¸ªå•å…ƒçš„è¾“å…¥å€¼ä¸­
      - Forwarding is expensive in deep pipelines

| ![image](media/2badcef7c727fa80885920ff2135de627d60c1d7.png) | ![image](media/c4db4124bb0b6292aa5814f0abcbff466305f967.png) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

#### Control Hazards & Speculation

  - **Control Hazards** - æŒ‰ç…§ `Static instruction sequence` é¢„å–æŒ‡ä»¤, é¢„å–åˆ°é”™è¯¯æŒ‡ä»¤
      - **example:** å‰ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œå®Œè·³è½¬äº†, æå‰ Fetch çš„æŒ‡ä»¤æ˜¯é”™è¯¯çš„

| ![image](media/bceb254dd6815ff698a964f92b94ab10db580035.png) | ![InkedFoxitReader\_VtCwFCBeQv\_LI](media/bc0bd6c06ddda52f04d044b3044294e8161353da.jpg) |
| ------------------------------------------------------------ | --------------------------------------------------------------------------------------- |

  - è§£å†³æ–¹æ¡ˆ: **Speculation** - CPU çŒœæµ‹ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤ - å¦‚æœçŒœé”™, `rolling back`
      - > 95% çŒœå¯¹ï¼Ÿï¼Ÿ

### Out-of-Order

  - **Out-Of-Order(OoO):** ä¹±åºæ‰§è¡Œ - `æ‰§è¡Œå·²ç»å‡†å¤‡å¥½çš„æŒ‡ä»¤`
  - **Dataflow:** æ ¹æ®å¯„å­˜å™¨ä¾èµ–å¹¶è¡Œæ‰§è¡Œ
      - **True dependence:** `read-after-write`
  - **Latency Bound** - `Critical Path` - è¿­ä»£ä¸­æœ€é•¿è·¯å¾„
  - **Throughput Bound** - `Execution Unit æ•°é‡(å¹¶è¡Œæ‰§è¡ŒæŒ‡ä»¤çš„ä¸ªæ•°)/Structural
    hazards`
  - Out-of-Order æ¯” In-Order å¯¹å¥½ä»£ç æ›´å°‘é™åˆ¶

| ![image](media/a57544c155b9d423baacf45ed4743bdeea1ddad6.png) | ![image](media/c9b0d11aa9cfd4cd767fb642313561a48528d1fa.png) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

| ![image](media/9642f49e6846ba8ef89748ee1dd388d37c2a8ef3.png) | ![InkedFoxitReader\_lUNIOkZCSc\_LI](media/d7978cd103d5c5a9f2321e9dcdeb6a3f8a91c9db.jpg) |
| ------------------------------------------------------------ | --------------------------------------------------------------------------------------- |

>   - ldr, mul execute in 2 cycles
>   - cmp, bne execute in 1 cycle
>   - mla executes in 3 cycles
>   - æ¯ä¸ªå¾ªç¯æ‰§è¡Œ 3 cycles, ä¸€å…± 5 æ¡æŒ‡ä»¤
>   - IPC(Instructions per cycle) `= 5/3 =1.66... > 1`(perfect pipeling)

#### Structural hazard

  - **Structural hazard**: æµ®ç‚¹æ•°/æ•´æ•°/Memory ç‰¹æ®Šç¡¬ä»¶èµ„æºæœ‰é™

![InkedFoxitReader\_K5l8eERM5G\_LI](media/62fda10ab5481d11dc0ebdb3844b0054baca14c0.jpg)

## Summary

  - ILP & Pipeline æ‰©å±•æ€§ä¸å¥½/åŠ¨æ€è°ƒåº¦ & OoO æ›´å¤æ‚/ä»£ä»·æ›´é«˜
  - å¹¶è¡ŒæŒ‡ä»¤æ˜¯å¦ç‹¬ç«‹éœ€è¦ O(w<sup>2</sup>) çš„æ¯”è¾ƒ, W= `issue width of processor`
  - Multicore æ›´ Efficient

![image](media/696c1e393ad1ea5db95caf7dd22c687180daf22e.png)
